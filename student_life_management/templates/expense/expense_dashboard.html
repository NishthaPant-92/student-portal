<!DOCTYPE html>
<html>
<head>
    <title>Expense Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light p-4">

<div class="container">

    <!-- üîπ Top Navigation -->
    <div class="d-flex justify-content-between align-items-center mb-4">

        <a href="{% url 'dashboard' %}" class="btn btn-outline-dark">
            üè† Home
        </a>

        <h2>üí∞ Expense Dashboard</h2>

        <div>
            <a href="{% url 'set_budget' %}" class="btn btn-primary">
                üéØ Set Budget
            </a>

            <a href="{% url 'add_expense' %}" class="btn btn-success">
                + Add Expense
            </a>
        </div>
    </div>


    <!-- üîπ Budget Cards -->
    <div class="row mb-4">

        <div class="col-md-4">
            <div class="card p-3 text-center shadow-sm">
                <h5>Total Budget</h5>
                <h4 class="text-primary">‚Çπ{{ total_budget }}</h4>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card p-3 text-center shadow-sm">
                <h5>Total Spent</h5>
                <h4 class="text-danger">‚Çπ{{ total_spent }}</h4>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card p-3 text-center shadow-sm">
                <h5>Remaining Budget</h5>
                <h4 class="text-success">‚Çπ{{ remaining_budget }}</h4>
            </div>
        </div>

    </div>

    <!-- Budget Exceeded Alert -->
    {% if remaining_budget < 0 %}
    <div class="alert alert-danger text-center">
        ‚ö† You have exceeded your budget!
    </div>
    {% endif %}


    <!-- üîπ Expense Table -->
    <div class="card p-4 mb-4 shadow-sm">
        <h5 class="mb-3">All Expenses</h5>

        <table class="table table-bordered table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Total Amount</th>
                    <th>Split Info</th>
                    <th>Each Pays</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                {% for expense in expenses %}
                <tr>
                    <td>{{ expense.title }}</td>
                    <td>{{ expense.category }}</td>
                    <td>‚Çπ{{ expense.amount }}</td>

                    <td>
                        {% if expense.is_split %}
                            Split among {{ expense.total_people }} people
                        {% else %}
                            No Split
                        {% endif %}
                    </td>

                    <td>
                        ‚Çπ{{ expense.split_amount }}
                    </td>

                    <td>
                        <a href="{% url 'delete_expense' expense.id %}"
                           class="btn btn-danger btn-sm">
                           Delete
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center">
                        No expenses added yet.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>


    <!-- üîπ Charts Section -->
    <div class="row">

        <!-- Pie Chart -->
        <div class="col-md-6">
            <div class="card p-3 shadow-sm">
                <h5>Category Distribution</h5>
                <canvas id="pieChart"></canvas>
            </div>
        </div>

        <!-- Bar Chart -->
        <div class="col-md-6">
            <div class="card p-3 shadow-sm">
                <h5>Monthly Spending</h5>
                <canvas id="barChart"></canvas>
            </div>
        </div>

    </div>

</div>


<script>
    // üîπ Pie Chart
    const pieCtx = document.getElementById('pieChart');

    new Chart(pieCtx, {
        type: 'pie',
        data: {
            labels: {{ categories|safe }},
            datasets: [{
                data: {{ category_totals|safe }},
            }]
        }
    });

    // üîπ Bar Chart
    const barCtx = document.getElementById('barChart');

    new Chart(barCtx, {
        type: 'bar',
        data: {
            labels: {{ labels|safe }},
            datasets: [{
                label: "Monthly Spending",
                data: {{ totals|safe }},
            }]
        }
    });
</script>

</body>
</html>